<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OFF / Tangent ‚Äî Happy Path Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121823;
      --panel-soft: #161d2b;
      --text: #e6e9ef;
      --muted: #9aa4b2;
      --accent: #5eead4;
      --ok: #22c55e;
      --warn: #facc15;
      --err: #ef4444;
      --border: #1f2937;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 10% -10%, #162036, transparent),
                  radial-gradient(1000px 500px at 90% -20%, #0f2a22, transparent),
                  var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .badge {
      font-size: 12px;
      color: var(--muted);
      margin-left: 8px;
    }

    .backend {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--panel);
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 12px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--warn);
    }

    main {
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 20px;
      padding: 24px;
    }

    section {
      background: linear-gradient(180deg, var(--panel), var(--panel-soft));
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
    }

    section h2 {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: var(--muted);
      margin: 0 0 12px 0;
      text-transform: uppercase;
    }

    .flow {
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 360px;
    }

    .event {
      border-left: 3px solid var(--accent);
      padding: 10px 12px;
      background: rgba(255,255,255,0.02);
      border-radius: 6px;
      font-size: 13px;
    }

    .event small {
      color: var(--muted);
      display: block;
      margin-top: 4px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-top: auto;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(180deg, #1f2937, #0f172a);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 13px;
    }

    button.primary {
      border-color: var(--accent);
      color: var(--accent);
    }

    button.warn {
      border-color: var(--warn);
      color: var(--warn);
    }

    .config-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .field label {
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--warn);
    }

    input {
      background: #0b1220;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      color: var(--text);
      font-family: var(--mono);
      font-size: 12px;
    }

    .log {
      margin-top: 14px;
      background: #020617;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      height: 140px;
      overflow: auto;
      font-family: var(--mono);
      font-size: 11px;
      color: #a5b4fc;
    }
  </style>
</head>

<body>
  <header>
    <h1>OFF / Tangent ‚Äî ‚ÄúHappy Path‚Äù Demo <span class="badge">v0.451.1</span></h1>
    <div class="backend">
      <div class="dot" id="backendDot"></div>
      <span id="backendStatus">Backend: checking‚Ä¶</span>
      <button onclick="checkBackend()">Check</button>
    </div>
  </header>

  <main>
    <section>
      <h2>From Signal ‚Üí Vibe</h2>

      <div class="flow" id="flow">
        <div class="event">Waiting for action‚Ä¶</div>
      </div>

      <div class="controls">
        <button class="primary" onclick="seed()">Seed Happy Path</button>
        <button class="primary" onclick="run()">Run Happy Path (visual)</button>
        <button onclick="reset()">Reset UI</button>
      </div>
    </section>

    <section>
      <h2>Config & Telemetry</h2>

      <div class="config-grid">
        <div class="field">
          <label>Backend Base URL</label>
          <input id="baseUrl" value="https://off-backend.onrender.com" />
        </div>

        <div class="field">
          <label><span class="status" id="adminDot"></span> Admin API Key</label>
          <input id="adminKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>

        <div class="field">
          <label><span class="status" id="guestDot"></span> Guest API Key</label>
          <input id="guestKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>

        <div class="field">
          <label><span class="status" id="conciergeDot"></span> Concierge API Key</label>
          <input id="conciergeKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>

      <div class="log" id="log"></div>
    </section>
  </main>

<script>
  const flow = document.getElementById("flow");
  const log = document.getElementById("log");

  function addEvent(text, meta = "") {
    const div = document.createElement("div");
    div.className = "event";
    div.innerHTML = `${text}${meta ? `<small>${meta}</small>` : ""}`;
    flow.appendChild(div);
    flow.scrollTop = flow.scrollHeight;
  }

  function logLine(text) {
    log.textContent += text + "\n";
    log.scrollTop = log.scrollHeight;
  }

  async function checkBackend() {
    const dot = document.getElementById("backendDot");
    const label = document.getElementById("backendStatus");
    try {
      const res = await fetch(`${baseUrl.value}/health`);
      if (!res.ok) throw new Error();
      const data = await res.json();
      dot.style.background = "var(--ok)";
      label.textContent = `Backend OK ‚Ä¢ uptime ${Math.floor(data.uptime)}s`;
    } catch {
      dot.style.background = "var(--err)";
      label.textContent = "Backend unreachable";
    }
  }

  async function seed() {
    addEvent("Seeding happy path‚Ä¶");
    logLine("POST /debug/seed");
    const res = await fetch(`${baseUrl.value}/debug/seed`, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${adminKey.value}`
      }
    });
    if (!res.ok) {
      addEvent("Seed failed", "Check admin key");
      logLine("‚ùå Seed failed");
      return;
    }
    addEvent("Seed complete", "Guest + Concierge + Signal created");
    logLine("‚úÖ Seed success");
    adminDot.style.background = "var(--ok)";
  }

  async function run() {
    flow.innerHTML = "";
    addEvent("Guest creates signal", "Coffee reset near Fellini");
    await delay();
    addEvent("Concierges reviewing signal");
    await delay();
    addEvent("Offer submitted", "$20 ‚Ä¢ calm coffee + walk");
    await delay();
    addEvent("Guest accepts offer");
    await delay();
    addEvent("Vibe started üéâ");
  }

  function reset() {
    flow.innerHTML = `<div class="event">Waiting for action‚Ä¶</div>`;
    log.textContent = "";
  }

  function delay(ms = 500) {
    return new Promise(r => setTimeout(r, ms));
  }

  // Initial check
  checkBackend();
</script>
</body>
</html>
